version: 0.2

phases:
  install:
    commands:
      - echo Installing dependencies...
      - yum install -y python3-pip
      - pip3 install --upgrade pip
      - pip3 install awscli

  pre_build:
    commands:
      - echo Downloading source code from GitHub...
      - git clone https://github.com/cash08-bot/flask-app-demo
      - cd flask-app-demo
      - echo Building Docker image...
      - docker build -t task3demo-service-python .

  build:
    commands:
      - echo Running Docker image...
      - docker run -d -p 80:8080 task3demo-service-python

  post_build:
    commands:
      - echo Updating ECS service with the new Docker image...
      - aws ecs update-service --cluster task3demo-clu --service task3demo-service-python --force-new-deployment --region us-east-1
